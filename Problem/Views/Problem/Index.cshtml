
@{
    ViewBag.Title = "Index";
}

<script src="~/Scripts/bootstrap-datetimepicker.min.js" type="text/javascript"></script>
<script src="~/Scripts/bootstrap-datetimepicker.zh-CN.js" type="text/javascript"></script>
<link type="text/css" rel="stylesheet" href="~/Content/bootstrap-datetimepicker.min.css">



<div class="content">
    <div class="container-fluid">
        <div class="row">
            <div class="col-lg-12">
                <div class="card">
                    <div class="card-header border-0">
                        <div class="d-flex justify-content-between">
                            <h3 class="card-title">查询</h3>
                        </div>
                    </div>
                    <div class="card-body">
                        <form id="formSearch" class="form-horizontal">

                            <div class="row">
                                <label class="control-label col-sm-2" >开始日期</label>
                                <div class="col-sm-2" style="margin-top:2px;">
                                    <div class="input-append date" id="datetimepicker" data-date-format="yyyy-MM-dd" data-link-field="dtp_Start_input">
                                        <input type="text" id="StartDate" name="StartDate" class="form-control">
                                        <span class="add-on"><i class="icon-th"></i></span>
                                    </div>
                                    <input type="hidden" id="dtp_Start_input" value="" /><br />
                                </div>

                                <label class="control-label col-sm-2">投诉类型</label>
                                <div class="col-sm-2" style="margin-top:2px;">
                                    <select class="form-control" id="ComplaintsType">
                                        <option selected></option>
                                        <option>零公里-一般问题</option>
                                        <option>零公里-audit</option>
                                        <option>零公里- RC</option>
                                        <option>零公里- PRR</option>
                                        <option>零公里- CS1</option>
                                        <option>零公里- CS2</option>
                                        <option>售后-一般问题</option>
                                        <option>售后-重点问题</option>
                                    </select>
                                </div>

                                <label class="control-label col-sm-2">客户</label>
                                <div class="col-sm-2" style="margin-top:2px;">
                                    <select class="form-control" id="Customer">
                                        <option selected></option>
                                        <option>SAIC-总部</option>
                                        <option>SAIC-临港</option>
                                        <option>SAIC-南京</option>
                                        <option>SAIC-郑州</option>
                                        <option>SAIC-宁德</option>
                                        <option>SVW-总部</option>
                                        <option>SVW-安亭I</option>
                                        <option>SVW-安亭II</option>
                                        <option>SVW-安亭III</option>
                                        <option>SVW-总部</option>
                                        <option>SVW-南京</option>
                                        <option>SVW-仪征</option>
                                        <option>SVW-长沙</option>
                                        <option>SVW-宁波</option>
                                        <option>SGM-上海</option>
                                        <option>SGM-沈阳</option>
                                        <option>SGM-烟台</option>
                                        <option>SGM-武汉</option>
                                        <option>SGM-韩国</option>
                                        <option>SGM-巴西</option>
                                        <option>SGM-墨西哥</option>
                                        <option>SGMW-广西</option>
                                        <option>SGMW-重庆</option>
                                        <option>SGMW-青岛</option>
                                        <option>SGMW-印度</option>
                                        <option>MAXUS-南京</option>
                                        <option>MAXUS-无锡</option>
                                        <option>安道拓</option>
                                        <option>弗吉亚</option>
                                        <option>天成</option>
                                    </select>
                                </div>
                            </div>
                            <div class="row">
                                <label class="control-label col-sm-2">产品种类</label>
                                <div class="col-sm-2" style="margin-top:2px;">
                                    <select class="form-control" id="ProductType">
                                        <option></option>
                                        <option>前排左侧安全带</option>
                                        <option>前排右侧安全带</option>
                                        <option>后排左侧安全带</option>
                                        <option>后排右侧安全带</option>
                                        <option>后排中间安全带</option>
                                        <option>第二排左侧安全带（7座及以上）</option>
                                        <option>第二排中间侧安全带（7座及以上）</option>
                                        <option>第二排右侧安全带（7座及以上）</option>
                                        <option>第三排左侧安全带（7座及以上）</option>
                                        <option>第三排中间侧安全带（7座及以上）</option>
                                        <option>第三排右侧安全带（7座及以上）</option>
                                        <option>前排左侧插锁</option>
                                        <option>前排右侧插锁</option>
                                        <option>后排左侧插锁</option>
                                        <option>后排中间插锁</option>
                                        <option>后排右侧插锁</option>
                                        <option>第二排左侧插锁（7座及以上）</option>
                                        <option>第二排中间侧插锁（7座及以上）</option>
                                        <option>第二排右侧插锁（7座及以上）</option>
                                        <option>第三排左侧插锁（7座及以上）</option>
                                        <option>第三排中间侧插锁（7座及以上）</option>
                                        <option>第三排右侧插锁（7座及以上）</option>
                                        <option>DAB</option>
                                        <option>PAB</option>
                                        <option>CAB</option>
                                        <option>KAB</option>
                                        <option>SW-PU</option>
                                        <option>SW-真皮</option>
                                    </select>
                                </div>

                                <label class="control-label col-sm-2">风险等级</label>
                                <div class="col-sm-2" style="margin-top:2px;">
                                    <select class="form-control" id="RiskLevel">
                                        <option selected></option>
                                        <option>低</option>
                                        <option>中</option>
                                        <option>高</option>
                                    </select>
                                </div>

                                <label class="control-label col-sm-2">责任部门</label>
                                <div class="col-sm-2" style="margin-top:2px;">
                                    <select class="form-control" id="Responsible_Department">
                                        <option selected></option>
                                        <option>AB</option>
                                        <option>SB</option>
                                        <option>SW</option>
                                        <option>PCL</option>
                                        <option>TC</option>
                                    </select>
                                </div>
                            </div>
                        </form>
                    </div>
                    <div class="card-footer">
                        <button type="button"  id="btn_query" name="refresh" class="btn btn-primary" >查询</button>
                    </div>
                </div>
            </div>
        </div>
        <div class="row">
            <div class="col-lg-12">
                <div class="card">
                    <div class="card-header border-0">
                        <div class="d-flex justify-content-between">
                            <h3 class="card-title">问题列表</h3>
                            @*<a href="javascript:void(0);">View Report</a>*@
                        </div>
                    </div>
                    <div class="card-body">


                        <div id="toolbar" class="btn-group">

                        </div>
                        <form id="form">
                            <table id="MTable" class="text-nowrap"></table>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

            <script>

                $("#btn_query").click(function () {
                    $('#MTable').bootstrapTable('refresh');
                });


                $('#datetimepicker').datetimepicker({
                    language: 'zh-CN',
                    weekStart: 1,
                    todayBtn: 1,
                    autoclose: 1,
                    todayHighlight: 1,
                    startView: 2,
                    forceParse: 0,
                    minView: 2,
                });


                function RefreshData() {
                    $.ajax({
                        type: "GET",
                        url: "/Manage/CompleteData",
                        dataType: "json",
                        success: function (msg) {
                            //$('#MTable').bootstrapTable('destroy');
                            $("#MTable").bootstrapTable('load', msg);
                        },
                        error: function () {
                            alert("错误");
                        }
                    });
                }


                $(function () {
                    $("#MTable").bootstrapTable({    //'destroy' 是必须要加的==作用是加载服务器数据，初始化表格的内容Destroy the bootstrap table.
                        // method: 'get',
                        url: "/Problem/PData",
                        //contentType: "application/x-www-form-urlencoded",
                        toolbar: '#toolbar', //工具按钮用哪个容器
                        pagination: true, //是否显示分页（*）
                        striped: true,//隔行换色
                        sidePagination: 'client',//分页方式
                        //pageNumber: 1,//初始化table时显示的页码
                        //pageSize: 20,//每页条目
                        //sortable: true,//排序
                        //silent: true,
                        search: true,//启用搜索
                        //showColumns: true,//是否显示 内容列下拉框
                        showRefresh: true,//显示刷新按钮
                        clickToSelect: true,//点击选中checkbox
                        singleSelect: true,//启用单行选中
                        queryParams: queryParams,
                        columns: [{
                            checkbox: true
                        }, {
                            field: 'OccurredTime',
                            title: '发生时间',
                            formatter: CovertToDate
                        }, {
                            field: 'Week',
                            title: '周'
                        }, {
                            field: 'ComplaintsType',
                            title: '投诉类型',
                            //formatter: TypeFormatter
                        }, {
                            field: 'Customer',
                            title: '客户',
                        }, {
                            field: 'Model',
                            title: '车型',
                        }, {
                            field: 'CusPartNum',
                            title: '客户零件号',
                        }, {
                            field: 'InPartNum',
                            title: '内部零件号',
                        }, {
                            field: 'Factory',
                            title: '工厂',
                        }, {
                            field: 'ProductType',
                            title: '产品种类',
                        }, {
                            field: 'DefectNum',
                            title: '缺陷数',
                        }, {
                            field: 'SpecialEffects',
                            title: '特殊影响',
                        }, {
                            field: 'RiskLevel',
                            title: '风险等级',
                        }, {
                            field: 'RiskAssessment',
                            title: '风险评估',
                        }, {
                            field: 'DefectLevel',
                            title: '缺陷等级',
                        }, {
                            field: 'DescribePro',
                            title: '问题描述',
                        }, {
                            field: 'Reason',
                            title: '原因',
                        }, {
                            field: 'Measure',
                            title: '措施',
                        }, {
                            field: 'Responsible_Department',
                            title: '责任部门',
                        }, {
                            field: 'Responsible_Person',
                            title: '责任人',
                        }, {
                            field: 'ReportTime',
                            title: '汇报时间',
                            formatter: CovertToDate
                        }]

                    });

                });


                function queryParams(params) {
                    return {
                        StartDate: $("#StartDate").val(),
                        ComplaintsType: $("#ComplaintsType").val(),
                        Customer: $("#Customer").val(),
                        ProductType: $("#ProductType").val(),
                        RiskLevel: $("#RiskLevel").val(),
                        Responsible_Department: $("#Responsible_Department").val()
                    }
                }


                function CovertToDate(unittime) {
                    unittime = unittime.replace("/Date(", "").replace(")/", "");
                    var time = unittime.substr(0, unittime.length - 3);

                    time = time * 1000;
                    var jsDate = new Date(time);
                    var UnixTimeToDate = jsDate.getFullYear() + '-' + (jsDate.getMonth() + 1) + '-' + jsDate.getDate();
                    //+ ' ' + jsDate.getHours() + ':' + jsDate.getMinutes() + ':' + jsDate.getSeconds();
                    return UnixTimeToDate;
                }

                function CovertToDateOnly(unittime) {
                    if (unittime == null) {
                        return null;
                    }
                    unittime = unittime.replace("/Date(", "").replace(")/", "");
                    var time = unittime.substr(0, unittime.length - 3);

                    time = time * 1000;
                    var jsDate = new Date(time);
                    var UnixTimeToDate = jsDate.getFullYear() + '-' + (jsDate.getMonth() + 1) + '-' + jsDate.getDate();
                    //+ ' ' + jsDate.getHours() + ':' + jsDate.getMinutes() + ':' + jsDate.getSeconds();
                    return UnixTimeToDate;
                }






            </script>
